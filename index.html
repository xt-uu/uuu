<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üíò ‰∏ìÂ±ûËÆ§‰∫≤ÊåëÊàò</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+KuaiLe&family=Microsoft+YaHei&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            transition: all 0.3s ease;
            font-family: "Ma Shan Zheng", "ZCOOL+KuaiLe", "Microsoft YaHei", "SimHei", "Arial", sans-serif;
        }
        body {
            height: 100vh;
            background-image: url("https://picsum.photos/id/1069/1920/1080");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            padding: 0 15px;
            background-color: #f0f8ff;
            animation: pageFadeIn 1.5s ease forwards;
        }
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            z-index: -1;
            animation: bgZoom 20s infinite alternate;
        }
        @keyframes bgZoom { 0% { transform: scale(1); } 100% { transform: scale(1.05); } }
        .corner-decoration {
            position: absolute;
            width: clamp(80px, 15vw, 150px);
            height: clamp(80px, 15vw, 150px);
            z-index: 1;
            opacity: 0.6;
            animation: patternRotate 8s infinite alternate ease-in-out;
        }
        @keyframes patternRotate { 0% { transform: rotate(-10deg) scale(0.95); } 100% { transform: rotate(10deg) scale(1.05); } }
        .pattern-top-left { top: 20px; left: 20px; border-top: 5px solid #4299e1; border-left: 5px solid #4299e1; }
        .pattern-top-right { top: 20px; right: 20px; border-top: 5px solid #4299e1; border-right: 5px solid #4299e1; }
        .pattern-bottom-left { bottom: 20px; left: 20px; border-bottom: 5px solid #4299e1; border-left: 5px solid #4299e1; }
        .pattern-bottom-right { bottom: 20px; right: 20px; border-bottom: 5px solid #4299e1; border-right: 5px solid #4299e1; }
        .background-dots {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(#4299e133 2px, transparent 2px);
            background-size: 30px 30px;
            z-index: -1;
            opacity: 0.5;
            animation: dotsMove 15s infinite linear;
        }
        @keyframes dotsMove { 0% { background-position: 0 0; } 100% { background-position: 30px 30px; } }
        .title {
            font-size: clamp(28px, 7vw, 52px);
            color: #4299e1;
            margin-bottom: 40px;
            text-align: center;
            opacity: 0;
            letter-spacing: 3px;
            animation: titleFadeIn 1s 0.3s forwards, titlePulse 3s infinite alternate;
            z-index: 10;
            text-shadow: 0 0 10px rgba(135, 206, 250, 0.6), 0 2px 12px rgba(66, 153, 225, 0.4);
        }
        @keyframes titleFadeIn { to { opacity: 1; } }
        @keyframes titlePulse {
            0% { transform: scale(1); text-shadow: 0 0 10px rgba(135, 206, 250, 0.6); }
            100% { transform: scale(1.05); text-shadow: 0 0 20px rgba(135, 206, 250, 0.8); }
        }
        .btn-container {
            position: relative;
            width: 100%;
            max-width: 380px;
            margin-bottom: 30px;
            z-index: 15;
            display: flex;
            justify-content: space-between;
            gap: 15px;
            align-items: center;
        }
        .choice-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            border-radius: 40px;
            font-size: clamp(22px, 5vw, 28px);
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            opacity: 0;
            transform: translateY(50px);
            transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease, background 0.3s ease, box-shadow 0.3s ease;
            will-change: transform, box-shadow;
            box-shadow: 
                0 8px 15px rgba(0, 0, 0, 0.2),
                0 0 25px rgba(135, 206, 250, 0.3) inset,
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
            position: relative;
            z-index: 50;
            min-width: 120px;
        }
        .choice-btn::after {
            content: "";
            position: absolute;
            top: 2px;
            left: 5%;
            width: 90%;
            height: 40%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .choice-btn:hover::after { opacity: 1; }
        #agreeBtn {
            background: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 30%, #4fc3f7 100%);
            animation: agreePulse 2s infinite alternate;
        }
        @keyframes agreePulse {
            0% { box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2), 0 0 25px rgba(135, 206, 250, 0.3) inset; }
            100% { box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25), 0 0 35px rgba(135, 206, 250, 0.5) inset; }
        }
        #disagreeBtn {
            background: linear-gradient(135deg, #64b5f6 0%, #4299e1 30%, #3182ce 100%);
            box-shadow: 
                0 8px 15px rgba(0, 0, 0, 0.2),
                0 0 25px rgba(66, 153, 225, 0.3) inset,
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
        }
        #disagreeBtn.sync-agree {
            background: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 30%, #4fc3f7 100%);
            box-shadow: 
                0 8px 15px rgba(0, 0, 0, 0.2),
                0 0 25px rgba(135, 206, 250, 0.3) inset,
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
        }
        #agreeBtn.enlarge1 {
            transform: scale(1.2);
            box-shadow: 
                0 10px 20px rgba(0,0,0,0.25), 
                0 0 40px rgba(135, 206, 250, 0.5),
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
            z-index: 60;
            animation: breathe 1.5s infinite alternate;
            opacity: 1 !important;
        }
        #agreeBtn.enlarge2 {
            transform: scale(1.4);
            box-shadow: 
                0 12px 25px rgba(0,0,0,0.3), 
                0 0 50px rgba(135, 206, 250, 0.6),
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
            z-index: 60;
            animation: breathe2 1s infinite alternate;
            opacity: 1 !important;
        }
        @keyframes breathe {
            0% { transform: scale(1.2); box-shadow: 0 10px 20px rgba(0,0,0,0.25), 0 0 40px rgba(135, 206, 250, 0.5), 0 2px 5px rgba(255, 255, 255, 0.7) inset; }
            100% { transform: scale(1.25); box-shadow: 0 12px 22px rgba(0,0,0,0.3), 0 0 45px rgba(135, 206, 250, 0.6), 0 2px 5px rgba(255, 255, 255, 0.7) inset; }
        }
        @keyframes breathe2 {
            0% { transform: scale(1.4); box-shadow: 0 12px 25px rgba(0,0,0,0.3), 0 0 50px rgba(135, 206, 250, 0.6), 0 2px 5px rgba(255, 255, 255, 0.7) inset; }
            100% { transform: scale(1.45); box-shadow: 0 14px 28px rgba(0,0,0,0.35), 0 0 55px rgba(135, 206, 250, 0.7), 0 2px 5px rgba(255, 255, 255, 0.7) inset; }
        }
        .choice-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                0 12px 20px rgba(0, 0, 0, 0.25), 
                0 0 40px rgba(135, 206, 250, 0.6),
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
        }
        #disagreeBtn:not(.sync-agree):hover {
            box-shadow: 
                0 12px 20px rgba(0, 0, 0, 0.25), 
                0 0 40px rgba(66, 153, 225, 0.6),
                0 2px 5px rgba(255, 255, 255, 0.7) inset;
        }
        .choice-btn:active {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.2), 
                0 0 25px rgba(135, 206, 250, 0.4),
                0 1px 3px rgba(255, 255, 255, 0.7) inset;
            background: linear-gradient(135deg, #90caf9 0%, #64b5f6 30%, #42a5f5 100%);
        }
        #disagreeBtn:not(.sync-agree):active {
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.2), 
                0 0 25px rgba(66, 153, 225, 0.4),
                0 1px 3px rgba(255, 255, 255, 0.7) inset;
            background: linear-gradient(135deg, #54a0ff 0%, #3b7dca 30%, #2962ff 100%);
        }
        .success-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 1001;
            text-align: center;
            padding: 20px 15px;
            border-radius: 20px;
            width: clamp(120px, 25vw, 200px);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 30px rgba(135, 206, 250, 0.3);
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.85);
            will-change: transform, opacity;
        }
        .success-popup.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25), 0 0 40px rgba(135, 206, 250, 0.4);
            animation: popupBounce 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes popupBounce {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .success-popup.final {
            width: clamp(180px, 35vw, 280px);
            padding: 30px 20px;
            z-index: 1002;
            box-shadow: 0 0 30px rgba(255, 193, 7, 0.8), 0 20px 50px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.98);
            animation: finalPopupPulse 1.5s infinite alternate, finalPopupHighlight 0.5s forwards;
        }
        @keyframes finalPopupHighlight {
            0% { transform: translate(-50%, -50%) scale(0.9); box-shadow: 0 0 10px rgba(255, 193, 7, 0.5); }
            100% { transform: translate(-50%, -50%) scale(1.05); box-shadow: 0 0 30px rgba(255, 193, 7, 0.8), 0 20px 50px rgba(0, 0, 0, 0.3); }
        }
        .final .popup-content {
            font-size: clamp(22px, 4.5vw, 28px);
            color: #e67e22;
            text-shadow: 0 2px 15px rgba(255, 152, 0, 0.8), 0 0 20px rgba(255, 193, 7, 0.6);
            animation: textBlink 1.5s infinite alternate;
        }
        @keyframes textBlink {
            0% { text-shadow: 0 2px 10px rgba(255, 152, 0, 0.4); }
            100% { text-shadow: 0 2px 15px rgba(255, 152, 0, 0.8), 0 0 10px rgba(255, 193, 7, 0.5); }
        }
        .sad-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 1001;
            text-align: center;
            padding: 30px 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 30px rgba(186, 230, 253, 0.3);
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.85);
        }
        .sad-modal.active {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25), 0 0 40px rgba(186, 230, 253, 0.4);
        }
        .sad-emoji {
            font-size: clamp(60px, 15vw, 120px);
            margin-bottom: 15px;
            animation: emojiBounce 0.5s ease, emojiShake 2s infinite alternate;
        }
        @keyframes emojiBounce { 0% { transform: scale(0); } 70% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes emojiShake { 0% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.05) rotate(2deg); } 100% { transform: scale(1) rotate(-2deg); } }
        .sad-text {
            font-size: clamp(22px, 5vw, 32px);
            color: #4299e1;
            line-height: 1.6;
            text-shadow: 0 1px 8px rgba(66, 153, 225, 0.3);
            letter-spacing: 2px;
        }
        .emoji {
            background: none;
            -webkit-background-clip: none;
            background-clip: none;
            color: #ffb74d;
        }
        .level-up {
            position: fixed;
            top: 10%;
            right: -300px;
            z-index: 50;
            background: linear-gradient(135deg, #a8d8ff 0%, #81d4fa 50%, #b3e5fc 100%);
            color: #ffffff;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: clamp(18px, 4vw, 26px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 2px 5px rgba(255, 255, 255, 0.7) inset;
            transition: right 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            will-change: right;
            animation: levelBlink 2s infinite alternate;
            letter-spacing: 1px;
        }
        .level-up::before { content: "‚ú®"; margin-right: 8px; }
        @keyframes levelBlink {
            0% { opacity: 0.9; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 2px 5px rgba(255, 255, 255, 0.7) inset; }
            100% { opacity: 1; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25), 0 2px 5px rgba(255, 255, 255, 0.9) inset; }
        }
        .level-up.active { right: 10px; }
        .happy-emoji {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: clamp(150px, 30vw, 280px);
            color: #81d4fa;
            opacity: 0.5;
            pointer-events: none;
            z-index: 100;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s ease;
            animation: emojiRotate 2s infinite alternate;
            text-shadow: 0 0 30px rgba(135, 206, 250, 0.8);
        }
        @keyframes emojiRotate {
            0% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            100% { transform: translate(-50%, -50%) scale(1.05) rotate(10deg); }
        }
        .happy-emoji.active { transform: translate(-50%, -50%) scale(1); }
        .happy-emoji.fade-out { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        .explosion-particle {
            position: fixed;
            pointer-events: none;
            z-index: 50;
            border-radius: 50%;
            opacity: 1;
            will-change: transform, opacity;
            background: #81d4fa;
        }
        @keyframes btnVibrate {
            0% { transform: translateX(0) translateY(0); }
            20% { transform: translateX(-2px) translateY(-2px); }
            40% { transform: translateX(2px) translateY(2px); }
            60% { transform: translateX(-2px) translateY(2px); }
            80% { transform: translateX(2px) translateY(-2px); }
            100% { transform: translateX(0) translateY(0); }
        }
        .vibrate { animation: btnVibrate 0.2s ease-in-out; }
        @keyframes textFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .text-animate span { display: inline-block; animation: textFadeIn 0.3s forwards; }
        @keyframes explosion {
            0% { transform: scale(1) translate(0, 0); opacity: 1; }
            100% { transform: scale(0.5) translate(var(--dx), var(--dy)); opacity: 0; }
        }
        @keyframes btnShake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
            100% { transform: translateX(0); }
        }
        /* Èü≥‰πêÊéßÂà∂Âå∫Ê†∑Âºè */
        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(8px);
        }
        .music-btn {
            width: clamp(50px, 10vw, 70px);
            height: clamp(50px, 10vw, 70px);
            border-radius: 50%;
            background: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 100%);
            color: #ffffff;
            border: none;
            font-size: clamp(24px, 5vw, 32px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), 0 0 15px rgba(135, 206, 250, 0.4) inset;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .music-btn.playing { animation: musicRotate 3s infinite linear; }
        @keyframes musicRotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* ÊöÇÂÅúÁä∂ÊÄÅÊåâÈíÆÈ´ò‰∫ÆÂèçÈ¶à */
        .music-btn:not(.playing) {
            box-shadow: 0 0 20px rgba(255, 99, 71, 0.6), 0 4px 12px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #ffcccb 0%, #ff6b6b 100%);
        }
        .music-btn:hover { transform: scale(1.1); }
        .music-btn:active { 
            transform: scale(0.95); 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        /* ËøõÂ∫¶Êù°Ê†∑ÂºèÔºàÊñ∞Â¢ûÊöÇÂÅúÁä∂ÊÄÅÂèòËâ≤Ôºâ */
        .progress-container {
            width: clamp(120px, 25vw, 200px);
            height: 8px;
            background: rgba(135, 206, 250, 0.3);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #81d4fa 0%, #4299e1 100%);
            border-radius: 4px;
            transition: width 0.3s ease, background 0.3s ease;
            box-shadow: 0 0 10px rgba(135, 206, 250, 0.8);
        }
        /* ÊöÇÂÅúÊó∂ËøõÂ∫¶Êù°ÂèòËâ≤ */
        .progress-container.paused .progress-bar {
            background: linear-gradient(90deg, #ff6b6b 0%, #ff4757 100%);
            box-shadow: 0 0 10px rgba(255, 99, 71, 0.8);
        }
        .time-display {
            font-size: clamp(12px, 2vw, 14px);
            color: #4299e1;
            text-align: center;
            margin-top: 5px;
            font-family: "Microsoft YaHei", sans-serif;
        }
        /* ÊöÇÂÅúÊó∂Êó∂Èó¥ÊñáÊú¨ÂèòËâ≤ */
        .progress-container.paused + .time-display {
            color: #ff4757;
        }
    </style>
</head>
<body>
    <div class="background-dots"></div>
    <div class="corner-decoration pattern-top-left"></div>
    <div class="corner-decoration pattern-top-right"></div>
    <div class="corner-decoration pattern-bottom-left"></div>
    <div class="corner-decoration pattern-bottom-right"></div>
    <h1 class="title">‰Ω†ÊÑøÊÑèÂÅöÊàëÁöÑerziÂêóÔºü</h1>
    <div class="btn-container">
        <button class="choice-btn" id="agreeBtn">ÊÑøÊÑè</button>
        <button class="choice-btn" id="disagreeBtn">‰∏çÊÑøÊÑè</button>
    </div>
    <div class="sad-modal" id="sadModal">
        <div class="sad-emoji">üò≠</div>
        <div class="sad-text text-animate">Á°ÆÂÆö‰πà<span class="emoji">üò≠</span></div>
    </div>
    <!-- Èü≥‰πêÊéßÂà∂Âå∫ÔºàÂê´ËøõÂ∫¶Êù°Ôºâ -->
    <div class="music-control">
        <button class="music-btn playing" id="musicBtn">‚è∏Ô∏è</button>
        <div>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
        </div>
    </div>
    <!-- Êú¨Âú∞Èü≥‰πêÔºöffÊñá‰ª∂Â§π‰∏ãÁöÑmm.mp3 -->
    <audio id="bgMusic" loop preload="auto">
        <source src="ff/mm.mp3" type="audio/mpeg">
        ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÈü≥È¢ëÊí≠Êîæ
    

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ëé∑ÂèñÊâÄÊúâÊ†∏ÂøÉÂÖÉÁ¥†
            const elements = {
                agreeBtn: document.getElementById("agreeBtn"),
                disagreeBtn: document.getElementById("disagreeBtn"),
                sadModal: document.getElementById("sadModal"),
                musicBtn: document.getElementById("musicBtn"),
                bgMusic: document.getElementById("bgMusic"),
                progressContainer: document.getElementById("progressContainer"),
                progressBar: document.getElementById("progressBar"),
                timeDisplay: document.getElementById("timeDisplay")
            };

            // Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®ÔºåÈÅøÂÖçÊä•Èîô
            if (!elements.agreeBtn || !elements.disagreeBtn || !elements.musicBtn || !elements.bgMusic || !elements.progressContainer || !elements.progressBar || !elements.timeDisplay) {
                console.error("Ê†∏ÂøÉÂÖÉÁ¥†Êú™ÊâæÂà∞ÔºåËØ∑Ê£ÄÊü•HTMLÁªìÊûÑÔºÅ");
                return;
            }

            // Áä∂ÊÄÅÁÆ°ÁêÜ
            const state = {
                disagreeClickCount: 0,
                sadModalTimer: null,
                emojiTimer: null,
                isAnimating: false,
                popupCount: 15,
                popupDelay: 150,
                finalPopupDelay: 12000,
                isMusicPlaying: true // ÂàùÂßã‰∏∫Êí≠ÊîæÁä∂ÊÄÅ
            };

            // ÂºπÁ™óÊñáÊú¨
            const POPUP_TEXT = "ËÄ∂ÔºÅ‰Ω†‰ª•ÂêéÂ∞±ÊòØÊàëÁöÑÁà±Â≠ê‰∫ÜÔºåÂìàÂìàÔºÅüòúüòúüòúüòÅ";

            // ÊåâÈíÆÈúáÂä®ÊïàÊûú
            function triggerVibration(btn) {
                btn.classList.add('vibrate');
                setTimeout(() => btn.classList.remove('vibrate'), 200);
                if (window.navigator.vibrate) navigator.vibrate([20, 10, 20]);
            }

            // Ê†ºÂºèÂåñÊó∂Èó¥ÔºàÁßíËΩ¨ÂàÜ:ÁßíÔºâ
            function formatTime(seconds) {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            }

            // Êõ¥Êñ∞Èü≥‰πêËøõÂ∫¶Êù°ÂíåÊó∂Èó¥ÊòæÁ§∫
            function updateProgress() {
                const duration = elements.bgMusic.duration || 0;
                const currentTime = elements.bgMusic.currentTime || 0;
                const progressPercent = (currentTime / duration) * 100;
                elements.progressBar.style.width = `${progressPercent}%`;
                elements.timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
            }

            // ÊãñÂä®ËøõÂ∫¶Êù°Ë∞ÉÊï¥Êí≠Êîæ‰ΩçÁΩÆ
            function seekProgress(e) {
                const containerRect = elements.progressContainer.getBoundingClientRect();
                const clickPosition = (e.clientX - containerRect.left) / containerRect.width;
                const duration = elements.bgMusic.duration || 0;
                elements.bgMusic.currentTime = clickPosition * duration;
                updateProgress();
            }

            // Èü≥‰πêÊí≠Êîæ/ÊöÇÂÅúÊéßÂà∂ÔºàÊñ∞Â¢ûÊöÇÂÅúÁä∂ÊÄÅËßÜËßâÂàáÊç¢Ôºâ
            function toggleMusic() {
                if (state.isMusicPlaying) {
                    // ÊöÇÂÅúÈü≥‰πêÔºöÊõ¥Êñ∞ËßÜËßâÁä∂ÊÄÅ
                    elements.bgMusic.pause();
                    elements.musicBtn.innerText = "‚ñ∂Ô∏è";
                    elements.musicBtn.classList.remove('playing');
                    elements.progressContainer.classList.add('paused'); // ËøõÂ∫¶Êù°Âä†ÊöÇÂÅúÁ±ª
                } else {
                    // Êí≠ÊîæÈü≥‰πêÔºöÊÅ¢Â§çËßÜËßâÁä∂ÊÄÅ
                    elements.bgMusic.play().catch(err => {
                        console.error("Èü≥‰πêÊí≠ÊîæÂ§±Ë¥•Ôºö", err);
                        alert("Èü≥‰πêÊñá‰ª∂Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á°ÆËÆ§Ôºö\n1. ffÊñá‰ª∂Â§π‰∏éHTMLÊñá‰ª∂Âú®Âêå‰∏ÄÁõÆÂΩï\n2. Èü≥‰πêÊñá‰ª∂Âêç‰∏∫mm.mp3ÔºàÂ§ßÂ∞èÂÜôÊïèÊÑüÔºâ\n3. Êñá‰ª∂Ê†ºÂºè‰∏∫MP3");
                    });
                    elements.musicBtn.innerText = "‚è∏Ô∏è";
                    elements.musicBtn.classList.add('playing');
                    elements.progressContainer.classList.remove('paused'); // ÁßªÈô§ÊöÇÂÅúÁ±ª
                }
                state.isMusicPlaying = !state.isMusicPlaying;
            }

            // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéËá™Âä®Êí≠ÊîæÈü≥‰πê
            function autoPlayMusic() {
                elements.bgMusic.play().catch(err => {
                    console.log("Ëá™Âä®Êí≠ÊîæË¢´ÊµèËßàÂô®ÈôêÂà∂ÔºåÁÇπÂáªÈ°µÈù¢ÂêéÂèØÊâãÂä®Êí≠ÊîæÔºö", err);
                    // Ëã•Ëá™Âä®Êí≠ÊîæÂ§±Ë¥•ÔºåÊèêÁ§∫Áî®Êà∑ÁÇπÂáªÈ°µÈù¢ÂêéÊâãÂä®Êí≠Êîæ
                    document.body.addEventListener('click', () => {
                        if (!state.isMusicPlaying) toggleMusic();
                    }, { once: true });
                });
            }

            // Â∑•ÂÖ∑ÂáΩÊï∞
            const utils = {
                getClientPos(e) {
                    if (e.touches && e.touches[0]) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
                    return { x: e.clientX || window.innerWidth / 2, y: e.clientY || window.innerHeight / 2 };
                },
                removeAllElements(className) {
                    document.querySelectorAll(`.${className}`).forEach(el => el.remove());
                },
                initBtnEntry() {
                    // ÊåâÈíÆÊ∏êÂÖ•Âä®Áîª
                    setTimeout(() => {
                        elements.agreeBtn.style.opacity = 1;
                        elements.agreeBtn.style.transform = 'translateY(0)';
                    }, 500);
                    setTimeout(() => {
                        elements.disagreeBtn.style.opacity = 1;
                        elements.disagreeBtn.style.transform = 'translateY(0)';
                    }, 800);
                },
                getRandomPos() {
                    const x = Math.random() * 85 + 7.5;
                    const y = Math.random() * 85 + 7.5;
                    return { x: `${x}%`, y: `${y}%` };
                },
                getCenterPos() { return { x: '50%', y: '50%' }; }
            };

            // ÁâπÊïàÂáΩÊï∞
            const effects = {
                showLevelUp(text) {
                    utils.removeAllElements("level-up");
                    const level = document.createElement("div");
                    level.className = "level-up";
                    level.innerText = text;
                    document.body.appendChild(level);
                    setTimeout(() => level.classList.add("active"), 100);
                    setTimeout(() => level.remove(), 2000);
                },
                showHappyEmoji(callback) {
                    utils.removeAllElements("happy-emoji");
                    const emoji = document.createElement("div");
                    emoji.className = "happy-emoji";
                    emoji.innerText = "üòÜ";
                    document.body.appendChild(emoji);
                    setTimeout(() => emoji.classList.add("active"), 100);
                    state.emojiTimer = setTimeout(() => {
                        emoji.classList.add("fade-out");
                        setTimeout(() => { emoji.remove(); callback && callback(); }, 600);
                    }, 1500);
                },
                createExplosion(x, y, count = 10, color = '#a8d8ff') {
                    for (let i = 0; i < count; i++) {
                        const particle = document.createElement("div");
                        particle.className = "explosion-particle";
                        const size = Math.random() * 6 + 2;
                        const angle = Math.random() * Math.PI * 2;
                        const distance = Math.random() * 30 + 10;
                        const dx = Math.cos(angle) * distance;
                        const dy = Math.sin(angle) * distance;
                        particle.style.width = `${size}px`;
                        particle.style.height = `${size}px`;
                        particle.style.left = `${x - size/2}px`;
                        particle.style.top = `${y - size/2}px`;
                        particle.style.background = color;
                        particle.style.setProperty('--dx', `${dx}px`);
                        particle.style.setProperty('--dy', `${dy}px`);
                        particle.style.animation = `explosion 0.6s forwards ease-out`;
                        document.body.appendChild(particle);
                        setTimeout(() => particle.remove(), 600);
                    }
                },
                shakeButton(btn) {
                    const originalAnimation = btn.style.animation;
                    btn.style.animation = 'btnShake 0.5s ease';
                    setTimeout(() => btn.style.animation = originalAnimation, 500);
                },
                createPopup(index) {
                    const popup = document.createElement("div");
                    popup.className = "success-popup";
                    if (index === state.popupCount - 1) {
                        popup.classList.add("final");
                    }
                    let pos = index === state.popupCount - 1 ? utils.getCenterPos() : utils.getRandomPos();
                    popup.style.top = pos.y;
                    popup.style.left = pos.x;
                    const scale = index === state.popupCount - 1 ? 1 : (0.8 + Math.random() * 0.4);
                    popup.style.transform = `translate(-50%, -50%) scale(${scale * 0.9})`;
                    const content = document.createElement("div");
                    content.className = "popup-content text-animate";
                    content.innerText = POPUP_TEXT;
                    popup.appendChild(content);
                    document.body.appendChild(popup);
                    requestAnimationFrame(() => {
                        setTimeout(() => {
                            popup.classList.add("active");
                            animateText(content);
                            if (index !== state.popupCount - 1) {
                                setTimeout(() => {
                                    popup.classList.remove("active");
                                    setTimeout(() => popup.remove(), 300);
                                }, 2000);
                            } else {
                                setTimeout(() => {
                                    popup.classList.remove("active");
                                    setTimeout(() => popup.remove(), 300);
                                }, state.finalPopupDelay + 3000);
                            }
                        }, index * state.popupDelay);
                    });
                },
                createMultiPopups() {
                    utils.removeAllElements("success-popup");
                    for (let i = 0; i < state.popupCount; i++) {
                        this.createPopup(i);
                    }
                }
            };

            // ÊñáÊú¨ÈÄêÂ≠óÂä®Áîª
            function animateText(element) {
                const text = element.textContent;
                element.textContent = '';
                [...text].forEach((char, index) => {
                    const span = document.createElement('span');
                    span.textContent = char;
                    span.style.animationDelay = `${index * 0.1}s`;
                    element.appendChild(span);
                });
            }

            // ÂêåÊÑèÊåâÈíÆÁÇπÂáªÂ§ÑÁêÜ
            function handleSuccess(e) {
                if (state.isAnimating) return;
                state.isAnimating = true;
                triggerVibration(e.target);
                // Êí≠ÊîæÈü≥‰πêÔºàËã•Êú™Êí≠ÊîæÔºâ
                setTimeout(() => {
                    if (!state.isMusicPlaying) toggleMusic();
                }, 300);
                // ÊòæÁ§∫ÂºÄÂøÉË°®ÊÉÖ
                setTimeout(() => {
                    effects.showHappyEmoji(() => {
                        effects.createMultiPopups();
                        // ÈáçÁΩÆÂä®ÁîªÁä∂ÊÄÅ
                        const totalDuration = (state.popupCount - 1) * state.popupDelay + 2000 + state.finalPopupDelay + 6000;
                        setTimeout(() => state.isAnimating = false, totalDuration);
                    });
                }, 500);
                // ÁàÜÁÇ∏ÊïàÊûúÂíåÊèêÁ§∫
                const { x, y } = utils.getClientPos(e);
                setTimeout(() => {
                    effects.showLevelUp("ËÆ§‰∫≤ÊàêÂäüÔºÅ");
                    effects.createExplosion(x, y, 10, '#a8d8ff');
                    effects.shakeButton(e.target);
                }, 800);
            }

            // ‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞
            const handlers = {
                agreeClick(e) { handleSuccess(e); },
                disagreeClick(e) {
                    if (state.isAnimating) return;
                    state.isAnimating = true;
                    triggerVibration(e.target);
                    utils.removeAllElements("success-popup");
                    clearTimeout(state.sadModalTimer);
                    // ÁàÜÁÇ∏ÊïàÊûú
                    const { x, y } = utils.getClientPos(e);
                    effects.createExplosion(x, y, 8, '#4299e1');
                    effects.shakeButton(e.target);
                    // Á¨¨‰∏ÄÊ¨°ÊãíÁªù
                    if (state.disagreeClickCount < 2) {
                        if (state.disagreeClickCount === 0) {
                            elements.agreeBtn.classList.add('enlarge1');
                            effects.showLevelUp("ÂÜçËÄÉËôë‰∏ãÔºü");
                        } else {
                            elements.agreeBtn.classList.remove('enlarge1');
                            elements.agreeBtn.classList.add('enlarge2');
                            effects.showLevelUp("ÁúüÁöÑË¶ÅÊãíÁªùÂêóÔºü");
                        }
                        // ÊòæÁ§∫ÊÇ≤‰º§ÂºπÁ™ó
                        elements.sadModal.classList.add("active");
                        animateText(elements.sadModal.querySelector('.sad-text'));
                        // ÂÖ≥Èó≠ÂºπÁ™ó
                        state.sadModalTimer = setTimeout(() => {
                            elements.sadModal.classList.remove("active");
                            state.isAnimating = false;
                        }, 2000);
                        // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨ÂíåÈÄèÊòéÂ∫¶
                        elements.disagreeBtn.innerText = state.disagreeClickCount === 0 ? "Á°ÆÂÆöÂêóÔºü" : "ÁúüÁöÑÁ°ÆÂÆöÂêóÔºü";
                        elements.disagreeBtn.style.opacity = state.disagreeClickCount === 0 ? 0.7 : 0.5;
                        state.disagreeClickCount++;
                    } else {
                        // Á¨¨‰∏âÊ¨°ÁÇπÂáªÔºåËΩ¨‰∏∫ÂêåÊÑè
                        elements.disagreeBtn.classList.add('sync-agree');
                        elements.disagreeBtn.innerText = "ÊÑøÊÑè";
                        elements.disagreeBtn.style.opacity = 1;
                        elements.agreeBtn.classList.remove('enlarge1', 'enlarge2');
                        effects.showLevelUp("ÊúÄÁªàÂêåÊÑèÔºÅ");
                        effects.createExplosion(x, y, 10, '#a8d8ff');
                        // ÊòæÁ§∫ÂºÄÂøÉË°®ÊÉÖÂíåÂºπÁ™ó
                        effects.showHappyEmoji(() => {
                            effects.createMultiPopups();
                            const totalDuration = (state.popupCount - 1) * state.popupDelay + 2000 + state.finalPopupDelay + 3000;
                            setTimeout(() => {
                                elements.disagreeBtn.removeEventListener("click", handlers.disagreeClick);
                                elements.disagreeBtn.addEventListener("click", handleSuccess);
                                state.isAnimating = false;
                            }, totalDuration);
                        });
                    }
                }
            };

            // ÂàùÂßãÂåñÈ°µÈù¢
            utils.initBtnEntry();
            autoPlayMusic(); // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéËá™Âä®Êí≠ÊîæÈü≥‰πê
            
            // ÁªëÂÆö‰∫ã‰ª∂
            elements.agreeBtn.addEventListener("click", handlers.agreeClick);
            elements.disagreeBtn.addEventListener("click", handlers.disagreeClick);
            elements.musicBtn.addEventListener("click", toggleMusic);
            elements.progressContainer.addEventListener("click", seekProgress);
            // Èü≥‰πêÊí≠ÊîæËøõÂ∫¶Êõ¥Êñ∞
            elements.bgMusic.addEventListener("timeupdate", updateProgress);
            // Èü≥‰πêÂä†ËΩΩÂÆåÊàêÂêéÊõ¥Êñ∞ÊÄªÊó∂Èïø
            elements.bgMusic.addEventListener("loadedmetadata", updateProgress);

            // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅ
            elements.agreeBtn.addEventListener("touchstart", handlers.agreeClick);
            elements.disagreeBtn.addEventListener("touchstart", handlers.disagreeClick);
            elements.musicBtn.addEventListener("touchstart", toggleMusic);
            elements.progressContainer.addEventListener("touchstart", (e) => {
                e.preventDefault();
                seekProgress(e.touches[0]);
            });

            // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÈ¢ÑÂä†ËΩΩÊú¨Âú∞Èü≥È¢ë
            document.body.addEventListener('click', () => {
                if (!state.isMusicPlaying && elements.bgMusic.paused) {
                    elements.bgMusic.load(); // È¢ÑÂä†ËΩΩÊú¨Âú∞Èü≥È¢ëÔºåÊèêÂçáÊí≠ÊîæÈÄüÂ∫¶
                }
            }, { once: true });
        });
    </script>
</body>
</html>
